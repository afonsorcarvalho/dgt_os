<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>    
    <record model="ir.ui.view" id="dgt_os_form_view">
      <field name="name">dgt_os.os.form</field> 
      <field name="model">dgt_os.os</field> 
      <field name="arch" type="xml">
        <form string="Ordens de Serviço">
			<header>
					<button name="action_done" type="object" string="Concluir OS" class="oe_highlight" attrs="{'invisible':True}"/>
					<button name="action_repair_executar" type="object" string="Iniciar Execução" class="oe_highlight" attrs="{'invisible':[('state', 'not in',('draft','ready'))]}" />
					<button name="force_done" states="released" string="Forçar Execução" class="oe_highlight" type="object"/>
					<button name="force_parts_reservation" states="released" string="Forçar Reserva" type="object"/>
					<button name="action_repair_end" states="under_repair" type="object" string="Finalizar Execução" class="oe_highlight"/>
					<button name="action_repair_cancel" string="Cancelar" type="object" groups="base.group_no_one"/>
					<button name="action_draft" string="Rascunho" type="object" groups="base.group_no_one" />
					
					<!--Botao para mandar a os por e-email-->
					<!-- <button name="send_mail_template" string="Enviar por e-mail" type="object" class="oe_highlight" 
					confirm="Tem certeza que quer enviar o e-mail?" /> -->

					<field name="state" widget="statusbar" statusbar_visible="draft,under_repair,done"/>
			</header>
			<sheet string="Ordem de Servico"> 
			
				<h1>
					<field name="name"/>
				</h1>
				<group>
					<group>
						<field name="cliente_id"  attrs="{'readonly':[('state','not in','draft')]}"  />
						<field name="equipment_id" attrs="{'readonly':[('state','not in','draft')]}" domain="[('client_id.id', '=', cliente_id)]" />
						<field name="priority" widget="priority"/>
						
						
						
						<field name="account_analytic_id" domain="[('partner_id','=',cliente_id)]"/>
						
					</group>
					<group>
						<field name="contact_os" attrs="{'readonly': [('state', 'not in', 'draft')]}"/>
						<field name="email_to_send"/>
					<!--	<field name="location_id"/> -->
					<!--	<field name="picking_type" /> -->

					</group> 
				</group>
				
				<separator/>
				<group>
					 
					<group>
                            <field name="tecnicos_id"  widget="many2many_tags" domain="[('job_id', '=', 'TECNICO')]" attrs="{'readonly':[('state','=', 'done')]}"/>
							<field name="maintenance_type" string="Tipo de Manutenção"
								attrs="{'readonly':[('state','!=', 'draft')]}"/> 
							<field name="origin" string="Doc Origem"/>
							<field name="create_date" string="Data de Criação" readonly="True"/>
							<field name="sale_id"/>
							<!--  <field name="invoice_id" context="{'form_view_ref': 'account.invoice_form'}"
								attrs="{
									'readonly':[('state','=', 'done')],
								}"/>
							<field name="invoice_servico_id" context="{'form_view_ref': 'account.invoice_form'}"
								attrs="{
									'readonly':[('state','=', 'done')],
								}"/> -->
                    </group>
					<group>
                            <field name="date_scheduled" string="Data Programada" attrs="{'readonly':[('state','=', 'done')]}"/>
                            <field name="date_execution" string="Data de Execução" attrs="{'readonly':[('state','=', 'done')]}"/>
							<field name="date_start" string="Data de início da Execução" readonly="True"/>
							<label for="maintenance_duration"/>
								<div class="o_row">
									<field name="maintenance_duration" string="Tempo de Estimado"  widget="float_time"/> 
								</div>
							<label for="time_execution"/>
								<div class="o_row">
									<field name="time_execution" string="Tempo de Execução" class="oe_inline" readonly="True" widget="float_time"/> 
								</div>
							
                    </group>
				</group>
				<group>
					<field name="description" string="Descrição da O.S." attrs="{'readonly':[('state','=', 'done')]}"/>
				</group>
				<separator/>
				<notebook>
				
					<page string="Relatórios"  attrs="{'readonly':[('state','=', 'done')],'invisible':[('state', '=', 'draft')]}">
						<field name="relatorios" mode="tree" >
							<form string="Relatórios"  >
								<notebook>
									<page string="Relatórios Linha" >
										    <group col="4">
												<field name="name" string="Relatório"/>
												<field name="relatorio_num" string="Relatório Nº."/> 
												<field name="data_atendimento" string="Data de atendimento" />
												<field name="equipment_id" string="Equipamento"/>
												<field name="hora_inicio" string="Hora de inicio" widget="float_time" />
												<field name="hora_termino" string="Hora de termino" widget="float_time" />
											</group>
											<group>
												<field name="tecnicos_id"  widget="many2many_tags" domain="[('id', 'in',parent.tecnicos_id)]" />
												<field name="motivo_chamado" string="Motivo do Chamado"/>
												<field name="defeitos" string="Defeitos"/>
												<field name="servico_executados" string="Serviços Executados"/>
												<field name="pendencias" string="Pendências"/>
												<field name="time_execution" string="Tempo de execução" readonly="True" widget="float_time" />
											</group>
									</page>
								</notebook>
							</form>
							<tree string="Relatórios">
									<field name="name" string="Relatório"/>
									<field name="relatorio_num" string="Relatório Nº."/> 
									<field name="equipment_id" string="Equipamento" invisible="True" />
									<field name="motivo_chamado" string="Motivo do Chamado" invisible="True"/>
									<field name="defeitos" string="Defeitos" invisible="True"/>
									<field name="servico_executados" string="Serviços Executados" />
									<field name="pendencias" string="Pendências"/>
									<field name="time_execution" string="Tempo de execução" widget="float_time"/>
							</tree>
							
							</field>
					</page>

					<page string="Peças">

						<field name="pecas" nolabel="1" attrs="{'readonly':[('state','=', 'done')]}">
				
							<form string="Peças" >
								 <notebook>
									<page string="Pecas linhas"> 
									
											<group>
												<field name="aplicada" string="Status" />
												<field name="product_id"/>
												<field name="name"/>
											</group>
											<group>
												<field name="qty_available" string="Qtd Disp."/> 
												<field name="product_uom_qty" string="Qtd"/> 
												<field name="product_uom" string="Unidade"/> 
											
											</group>
											
									 </page>
								</notebook>
							</form>
							<tree string="Pecas" editable="bottom" >
								<field name="sequence" widget="handle"/>
                                <field name="aplicada"/>
                                <field name="product_id"/>
                                <field name='name'/> 
                                <field name="lot_id" domain="[('product_id', '=', product_id)]" context="{'default_product_id': product_id}" groups="stock.group_production_lot"/>
								<field name="qty_available" string="Qtd Disp."/>
                                <field name="product_uom_qty" string="Quantity"/>
                                <field name="product_uom" string="Unit of Measure" groups="product.group_uom"/>
                            </tree>
						</field>
					
						<div class="oe_clear"/>
					</page>
					<page string="Serviços">
						<field name="servicos" attrs="{'readonly':[('state','=', 'done')]}" >
							<form string="Serviços">
								<notebook>
										<page string="Serviços linhas">
											<group col="4">
												<field name="name"/>
												<field name="product_id"/>
												<field name="product_uom_qty"/>
												<field name="product_uom"/>
											
											</group>
										</page>
								</notebook>
							</form>
							<tree string="Serviços"  editable="bottom">
								<field name="sequence" widget="handle"/>
                                <field name="product_id"/>
                                <field name='name'/>
						        <field name="product_uom_qty" string="Quantity"/>  
                                <field name="product_uom" string="Unit of Measure" groups="product.group_uom"/>
								
                           </tree>
						</field>
						
					</page>
					
					<page string="CheckList" attrs="{'readonly':[('state','=','done')],'invisible':[('maintenance_type','=', 'corrective')]}">
						<field name="check_list" mode="tree">
						<form string="CheckList" >
							
								<field name="instruction"/> 
								<field name="check"/>
								<field name="observations"/>
							
						</form>
						<tree string="CheckList" editable="top">
							<field name="instruction" string="Instrução" readonly="True"/>
							<field name="check" string="Verificado"/> 
							<field name="observations" string="Observações" />
						</tree>
							
						</field>
					</page>
				</notebook>
			</sheet>
			<div class="o_attachment_preview" 
                 options="{types: ['image', 'pdf'], 'order': 'desc'}" />
			<div class="oe_chatter">
				    <field name="activity_ids" widget="mail_activity"/>
                    <field name="message_follower_ids" widget="mail_followers"/>
                    <field name="message_ids" widget="mail_thread"/>
            </div>
            </form>
        </field>
    </record>
    </data>
</odoo>